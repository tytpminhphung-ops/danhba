<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Danh bạ điện thoại </title>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <!-- DataTable Bootstrap 5 -->
    <link rel="stylesheet"
          href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <style>
        body { background: #f4f6f9; padding: 40px; }
        .card { border-radius: 14px; }
        .table thead th { background-color: #0d6efd; color: white; }
    </style>
</head>

<body>

<div class="container">
    <div class="card shadow">
        <div class="card-body">
            <h3 class="fw-bold text-primary mb-4">
                DANH BẠ ĐIỆN THOẠI TRẠM Y TẾ PHƯỜNG BÌNH THỚI
            </h3>

            <table id="myTable" class="table table-striped table-bordered" width="100%">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Họ và tên</th>
                        <th>Chức vụ</th>
                        <th>Chức danh</th>
                        <th>Điện thoại</th>
                        <th>Email cá nhân</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
let dataTable = null;
const REFRESH_TIME = 5000; // 5 giây
const sheetURL =
  "https://docs.google.com/spreadsheets/d/1Vpq9LUlp-9yH24_kRzpc9OxGNhvlGfiQDwGA9jA6qHk/export?format=csv";

// Hàm load dữ liệu Google Sheet
async function loadData(firstLoad = false) {
    let res = await fetch(sheetURL + "&t=" + new Date().getTime()); 
    let csv = await res.text();

    let rows = csv.split("\n").map(row => row.split(","));

    rows.shift(); // bỏ header

    let data = rows.map(r => [
        r[0] || "",
        r[1] || "",
        r[2] || "",
        r[3] || "",
        r[4] || "",
        r[5] || ""
    ]);

    if (firstLoad) {
        // Lần đầu khởi tạo DataTable
        dataTable = $("#myTable").DataTable({
            data: data,
            pageLength: 15,
            responsive: true,
            language: { 
                url: "https://cdn.datatables.net/plug-ins/1.13.6/i18n/vi.json"
            }
        });
    } else {
        // Lần sau: cập nhật realtime
        dataTable.clear();
        dataTable.rows.add(data);
        dataTable.draw(false); // giữ nguyên trang hiện tại
    }
}

// Lần đầu load
loadData(true);

// Lặp lại sau mỗi X giây
setInterval(() => loadData(false), REFRESH_TIME);
</script>


</body>
</html>


